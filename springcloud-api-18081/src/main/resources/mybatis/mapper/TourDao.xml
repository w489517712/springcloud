<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wxm.springcloud.tour.dao.TourDao">

    <insert id="register" >
        insert into v_user
            (name,password)
            values
            (
            #{name},
            #{passWord}
            )
    </insert>

    <insert id="save" >
            insert into  v_tour_info
            (name,money,lev,remark,setmeal,pngurl,contry)
            values
            (
            #{name},
            #{money},
            #{lev},
            #{remark},
            #{setmeal},
            #{pngurl},
            #{contry}

            )
    </insert>
    <select  id="queryList" resultType="com.wxm.springcloud.tour.po.Tour" >
          select *  from  v_tour_info t
          where 1=1
          <if test="city != null and city !=''">
              and  t.name = #{city}
          </if>

        <if test="id != null and id !=''">
            and  t.id = #{id}
        </if>

          <if test="tn != null and tn !=''">
              limit #{rn} , #{tn}
          </if>

    </select>


    <select  id="queryListTotal" resultType="int" >
        select count(*) from  v_tour_info t
        where 1=1
        <if test="city != null and city !=''">
            and  t.name = #{city}
        </if>
        <if test="id != null and id !=''">
            and  t.id = #{id}
        </if>
    </select>
    <select  id="checkLoginInfo" resultType="com.wxm.springcloud.tour.po.User" >
          select
            id,
            name,
            password passWord,
            token

            from v_user  where name = #{name} and password = #{password}
    </select>






    <select  id="queryTicketList" resultType="com.wxm.springcloud.tour.po.Ticket" >
        select *  from  v_ticket_info t
        where 1=1
        <if test="addrA != null and addrA !=''">
            and  t.addrA = #{addrA}
        </if>

        <if test="addrB != null and addrB !=''">
            and  t.addrB = #{addrB}
        </if>

        <if test="usetime != null and usetime !=''">
            and  t.usetime = #{usetime}
        </if>

        <if test="tn != null and tn !=''">
            limit #{rn} , #{tn}
        </if>

    </select>


    <select  id="queryTicketListTotal" resultType="int" >
        select count(*) from  v_ticket_info t
        where 1=1
        <if test="addrA != null and addrA !=''">
            and  t.addrA = #{addrA}
        </if>

        <if test="addrB != null and addrB !=''">
            and  t.addrB = #{addrB}
        </if>

        <if test="usetime != null and usetime !=''">
            and  t.usetime = #{usetime}
        </if>
    </select>




    <select  id="queryOrderList" resultType="com.wxm.springcloud.tour.po.Order" >
        select
        o.*,t.addrA,t.addrB,t.pngurl,t.remark ticketRemark,u.setmeal,DATE_FORMAT(o.createtime,'%Y-%m-%d') createtimeStr
        from v_order_info o
        left join v_ticket_info t
        on o.ticketid = t.id
        left join v_tour_info u
        on o.tourid = u.id

        where 1=1
        <if test="addrA != null and addrA !=''">
            and  t.addrA = #{addrA}
        </if>

        <if test="addrB != null and addrB !=''">
            and  t.addrB = #{addrB}
        </if>

        <if test="usetime != null and usetime !=''">
            and  t.usetime = #{usetime}
        </if>

        <if test="tn != null and tn !=''">
            limit #{rn} , #{tn}
        </if>

    </select>


    <select  id="queryOrderListTotal" resultType="int" >
        select
        count(*)
        from v_order_info o
        left join v_ticket_info t
        on o.ticketid = t.id
        left join v_tour_info u
        on o.tourid = u.id

        where 1=1
        <if test="addrA != null and addrA !=''">
            and  t.addrA = #{addrA}
        </if>

        <if test="addrB != null and addrB !=''">
            and  t.addrB = #{addrB}
        </if>

        <if test="usetime != null and usetime !=''">
            and  t.usetime = #{usetime}
        </if>
    </select>



    <update id="updateUserToken">

        update v_user set token = #{value}

    </update>


</mapper>

